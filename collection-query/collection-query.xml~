<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<!DOCTYPE rfc SYSTEM 'rfc2629.dtd'
[
<!ENTITY rfc2119 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml'>
<!ENTITY rfc3253 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3253.xml'>
<!ENTITY rfc3744 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3744.xml'>
<!ENTITY rfc4791 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4791.xml'>
<!ENTITY rfc4918 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4918.xml'>
<!ENTITY rfc5323 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5323.xml'>
<!ENTITY rfc6352 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.6352.xml'>
<!ENTITY rfc7230 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.7230.xml'>
<!ENTITY rfc8174 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.8174.xml'>
]>

<?rfc toc="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<?rfc tocdepth="2"?>
<?rfc strict="yes"?>
<rfc category="info" ipr='trust200902'
     docName='draft-murchison-webdav-collection-query-00'>
  <front>
    <title abbrev="Collection Query">
    Collection Query for Web Distributed Authoring and Versioning (WebDAV)</title> 

    <author initials="K." surname="Murchison"
            fullname="Kenneth Murchison">
      <organization abbrev="FastMail">FastMail US LLC</organization>
      <address>
        <postal>
          <street>1429 Walnut St, Suite 1201</street>
          <city>Philadephia</city>
          <region>PA</region>
          <code>19102</code>
          <country>United States of America</country>
        </postal>
        <email>murch@fastmailteam.com</email> 
        <uri>http://www.fastmail.com/</uri>
      </address> 
    </author> 

    <author initials="M." surname="Douglass" fullname="Michael Douglass">
      <organization abbrev="Spherical Cow Group">Spherical Cow Group</organization>
      <address>
        <postal>
          <street>226 3rd Street</street>
          <city>Troy</city>
          <region>NY</region>
          <code>12180</code>
          <country>USA</country>
        </postal>
        <email>mdouglass@sphericalcowgroup.com</email>
        <uri>http://sphericalcowgroup.com</uri>
      </address>
    </author>

    <date />

    <area>Applications and Real-Time</area> 
    <workgroup>Calendaring Extensions</workgroup>

    <keyword>iCalendar</keyword>
    <keyword>iTIP</keyword>
    <keyword>CalDAV</keyword>

    <abstract>
      <t>This specification adds an extension to the Calendaring
      Extensions to WebDAV (CalDAV) to allow discovery of publicly
      available calendars on a server.</t>
    </abstract>
  </front>

  <middle>
    <section title='Introduction'>
      <t>The <xref target='RFC5545'>iCalendar</xref> data format is
      used to represent calendar data and is used with <xref
      target='RFC5546'>iCalendar Transport-independent Interoperability
      Protocol (iTIP)</xref> to handle scheduling operations 
      between calendar users.</t>

      <t><xref target="RFC4791" /> defines the Calendaring Extensions
      to WebDAV (CalDAV),
      based on <xref target="RFC7230">HTTP</xref>, for
      accessing calendar data stored on a server.</t>

      <t>Calendar users often want to include attachments with their
      calendar data events or tasks (for example, a copy of a
      presentation or the meeting agenda). iCalendar provides an
      "ATTACH" property whose value is either the inline Base64
      encoded attachment data or a URL specifying the location of the
      attachment data.</t>
      
    </section> <!-- Intro -->

    <section title='Conventions Used in This Document'>

      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
      NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
      "MAY", and "OPTIONAL" in this document are to be interpreted as
      described in BCP&nbsp;14 <xref target="RFC2119"/>
      <xref target="RFC8174"/> when, and only when, they appear in all
      capitals, as shown here.</t>


      <t>This document uses XML DTD fragments ([W3C.REC-xml-20081126],
      Section 3.2) as a purely notational convention.  WebDAV request
      and response bodies cannot be validated by a DTD due to the
      specific extensibility rules defined in Section 17 of [RFC4918]
      and due to the fact that all XML elements defined by this
      specification use the XML namespace name "DAV:".  In particular:

      <list style='numbers'>
        <t>Element names use the "DAV:" namespace.</t>

        <t>Element ordering is irrelevant unless explicitly stated
        otherwise.</t>

        <t>Extension elements (elements not already defined as valid
        child elements) may be added anywhere, except when explicitly
        stated otherwise.</t>

        <t>Extension attributes (attributes not already defined as
        valid for this element) may be added anywhere, except when
        explicitly stated otherwise.</t>
      </list></t>

      <t>When an XML element type in the "DAV:" namespace is
      referenced in this document outside of the context of an XML
      fragment, the string "DAV:" will be prefixed to the element
      type.</t>

      <t>This document inherits, and sometimes extends, DTD
      productions from Section 14 of <xref target='RFC4918' />.</t>

    </section>

    <section title="Overview">
      <t>There are four main operations a client needs to perform with
      attachments for calendar data: add, update, remove, and
      retrieve. The first three operations are carried out by the
      client issuing an HTTP POST request on the calendar object
      resource to which the attachment is associated and specifying
      the appropriate "action" query parameter (see <xref
      target="attachment-post-request"/>).  In the case of the 
      remove operation, the client can alternatively directly update
      the calendar object resource and remove the relevant "ATTACH"
      properties (see <xref target="attachment-remove-put"/>). The
      retrieve operation is accomplished by simply 
      issuing an HTTP GET request targeting the attachment URI
      specified by the calendar resource's "ATTACH" property (see
      <xref target="attachment-retrieve"/>).</t>
      
      <t>iCalendar data stored in a CalDAV calendar object resource
      can contain multiple components when recurrences are involved.
      In such a situation, the client needs to be able to target a
      specific recurrence instance or multiple instances when adding
      or deleting attachments.  As a result, the POST request needs to
      provide a way for the client to specify which recurrence
      instances should be targeted for the attachment operation.  This
      is accomplished through use of additional query parameters on
      the POST Request-URI.</t>

      <section title="Requirements" anchor='requirements'>
        <t>A server that supports the features described in this
        specification is REQUIRED to support the CalDAV
        "calendar-access" <xref target="RFC4791"/> features.</t>
          
        <t>In addition, such a server SHOULD support the
        "return=representation" <xref target='RFC7240'>Prefer header
        field</xref> preference on successful HTTP PUT and POST requests
        targeting existing calendar object resources by returning the
        new representation of that calendar resource (including its
        new ETag header field value) in the response.</t>
      </section>

      <section title="Discovering Support for Managed Attachments"
	       anchor="support-managed-attachments">
        <t>A server supporting the features described in this
        specification MUST include "calendar-managed-attachments" as a
        token in the DAV response header field (as defined in Section
        10.1 of <xref target="RFC4918" />) from an OPTIONS request on a
        calendar home collection.</t>
        
        <t>A server might choose not to support the storing of managed
        attachments on a per-recurrence-instance basis (i.e., they can
        only be added to all instances as a whole). If that is the
        case, the server MUST also include
        "calendar-managed-attachments-no-recurrence" as a token in the
        DAV response header field from an OPTIONS request on a calendar home
        collection. When that field is present, clients MUST NOT
        attempt any managed attachment operations that target specific
        recurrence instances.</t>
      </section>
    </section>

    <section title='Security Considerations'>
      <t>There are no security considerations related to this memo.</t>
    </section>

    <section title='Acknowledgments'>
      <t>This document came about via discussions at the Calendaring
      and Scheduling Consortium.</t> 
    </section>

  </middle>

  <back>

    <references title='Normative References'>
      &rfc3253;
      &rfc3744;
      &rfc4918;
      &rfc5323;
      &rfc7230;
      &rfc8174;
    </references>

    <references title='Informative References'>
      &rfc4791;
      &rfc6352;
    </references>

<!--
    <section title="Change History (To be removed by RFC Editor before
                    publication)">
      <t>
        Changes in calext-00:
        <list style='numbers'>
          <t>Added Murchison as editor.</t>
          <t>Updated HTTP references to RFC7230 and RFC7231.</t>
          <t>Updated Prefer header field references to RFC7240.</t>
          <t>Added Implementation Status section.</t> 
          <t>Minor editorial changes.</t> 
       </list>
      </t>
    </section>
-->
  </back>
</rfc>
