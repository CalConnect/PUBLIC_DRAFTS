<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<rfc ipr="trust200902" category="info" docName="draft-ietf-calext-jscalendar-icalendar-00">
    <?rfc toc="yes"?>
    <?rfc symrefs="yes"?>
    <?rfc sortrefs="yes"?>
    <?rfc compact="no"?>
    <?rfc subcompact="no"?>
    <?rfc private=""?>
    <?rfc topblock="yes"?>
    <?rfc comments="no"?>

    <front>
        <title abbrev="JSCalendar">JSCalendar: Converting from and to iCalendar</title>
        <author initials="N.M." surname="Jenkins" fullname="Neil Jenkins">
            <organization>FastMail</organization>
            <address>
                <postal>
                    <street>PO Box 234</street>
                    <street>Collins St West</street>
                    <city>Melbourne</city>
                    <code>VIC 8007</code>
                    <country>Australia</country>
                    <region/>
                </postal>
                <phone/>
                <email>neilj@fastmailteam.com</email>
                <uri>https://www.fastmail.com</uri>
            </address>
        </author>
        <author initials="R." surname="Stepanek" fullname="Robert Stepanek">
            <organization>FastMail</organization>
            <address>
                <postal>
                    <street>PO Box 234</street>
                    <street>Collins St West</street>
                    <city>Melbourne</city>
                    <code>VIC 8007</code>
                    <country>Australia</country>
                    <region/>
                </postal>
                <email>rsto@fastmailteam.com</email>
                <uri>https://www.fastmail.com</uri>
            </address>
        </author>
        <date year="2019" month="May" day="1"/>
        <area>Applications</area>
        <workgroup>Calendaring extensions</workgroup>
        <keyword>JSON</keyword>
        <keyword>iCalendar</keyword>
        <keyword>calendar</keyword>
        <keyword>events</keyword>
        <keyword>date</keyword>
        <keyword>time</keyword>
        <abstract>
            <t>
                This document provides an informational guide for converting
                JSCalendar from and to iCalendar.
            </t>
        </abstract>
    </front>

    <middle>
        <section anchor="introduction" title="Introduction">

            <section anchor="motivation" title="Motivation">
                <t>
                    The JSCalendar <xref target="draft-ietf-calext-jscalendar"/> data format
                    is used to represent calendar data, and is meant as an alternative to
                    the widely deployed iCalendar <xref target="RFC5545"/> data format.
                </t>
                <t>
                    While new calendaring services and applications might use JSCalendar
                    as their main data format to exchange calendaring data, they will
                    have to interoperate with services and clients that just support iCalendar.
                    Similarly, existing calendaring data is stored in iCalendar format
                    in databases and other calendar stores, and providers and users might
                    want to represent this data also in JSCalendar. Lastly, some implementations
                    might want to preserve custom iCalendar properties, that have no
                    equivalent in JSCalendar when converting between these formats.
                </t>
                <t>
                    To facilitate these use cases, this document provides an
                    informational guide how to convert JSCalendar data from and to
                    iCalendar.
                </t>
            </section>

            <section anchor="scope" title="Scope and caveats">
                <t>
                    JSCalendar and iCalendar have a lot of semantics in common, but
                    they are no interchangeable formats:
                    <list style="symbols">
                        <t>
                            JSCalendar contains a richer data model for some things
                            (particularly locations); while future iCalendar extensions
                            may allow a direct mapping, for now there may be no representation
                            directly in iCalendar of some properties and these have been marked
                            as implementation specific for mapping.
                        </t>
                        <t>
                            iCalendar may contain arbitrary, non-standardised data with custom
                            properties/attributes. Translating these into JSCalendar is implementation
                            specific.
                        </t>
                        <t>
                            iCalendar has some obsolete features that have been removed from JSCalendar
                            due to not being useful and/or supported in the real world (e.g. custom
                            email alerts to send to random people). Translating these may lose some
                            of the original fidelity.
                        </t>
                        <t>
                            Implementations may use a custom property to store data that could not
                            be mapped directly in either direction in the original or a custom format,
                            however this is not interoperable (also see
                            <xref target="translate-custom"/>).
                        </t>
                    </list>
                    Accordingly, this document does not standardize a canonical translation
                    between iCalendar and JSCalendar, and implementations MUST NOT make
                    any assumptions how iCalendar data is represented in JSCalendar
                    by other systems.
                </t>
            </section>
        </section>

        <section anchor="translate-jsevent" title="JSEvent">
            <t>
                A <spanx style="emph">JSEvent</spanx> maps to the the iCalendar VEVENT component type
                <xref target="RFC5545"/>. A VEVENT component that is a direct child of a VCALENDAR component
                maps to a standalone JSEvent. A VEVENT component within a VEVENT
                maps to the entries of
                the JSEvent <spanx style="emph">recurrenceOverrides</spanx> property.
            </t>

            <texttable anchor="translate-jsevent-properties" title="Mapping JSEvent properties">
                <ttcol align='left'>Property</ttcol>
                <ttcol align='left'>iCalendar counterpart</ttcol>
                <c>duration</c>
                <c>
                    The iCalendar DURATION property. The iCalendar DTEND
                    property maps to the <spanx style="emph">duration</spanx> property
                    as the time span between DTSTART and DTEND when converting the
                    respective time points to the UTC time zone.
                </c>

            </texttable>
        </section>

        <section anchor="translate-jstask" title="JSTask">
            <t>
                A <spanx style="emph">JSTask</spanx> object maps to the iCalendar VTODO component type
                <xref target="RFC5545"/>. A VTODO component that is a direct child of ao
                VCALENDAR component map to a standalone JSTask. A VTODO component
                within a master VTODO maps to the entries of
                the JSTask <spanx style="emph">recurrenceOverrides</spanx> property.
            </t>
            <texttable anchor="translate-jstask-time-table" title="Mapping JSTask properties">
                <ttcol align='left'>Property</ttcol>
                <ttcol align='left'>iCalendar counterpart</ttcol>
                <c>due</c>
                <c>
                    The DUE or DURATION properties. When mapping iCalendar
                    VTODOs with DURATION, the due date is the result of adding DURATION
                    to DTSTART in the DTSTART time zone.
                </c>

                <c>estimatedDuration</c>
                <c>
                    The ESTIMATED-DURATION iCalendar
                    property in the RFC draft <xref target="draft-apthorp-ical-tasks"/>.
                </c>

                <c>statusUpdatedAt</c>
                <c>
                    The COMPLETED iCalendar property. The JSTask status property
                    MUST have value <spanx style="verb">completed</spanx>.
                </c>

                <c>progress</c>
                <c>
                    The PARTSTAT and COMPLETED properties, including the
                    definitions in the RFC draft <xref target="draft-apthorp-ical-tasks"/>.
                </c>

                <c>status</c>
                <c>
                    The STATUS property, including the
                    definitions in the RFC draft <xref target="draft-apthorp-ical-tasks"/>.
                </c>

            </texttable>
        </section>

        <section title="JSGroup">
            <t>
                A JSGroup maps to a iCalendar VCALENDAR containing VEVENT or VTODO components.
            </t>
            <texttable anchor="translate-jsgroup-table" title="Mapping JSGroup properties">
                <ttcol align='left'>Property</ttcol>
                <ttcol align='left'>iCalendar counterpart</ttcol>

                <c>entries</c>
                <c>
                    The VEVENT and VTODO components within a top-level VCALENDAR component.
                </c>

                <c>source</c>
                <c>
                    The SOURCE property.
                </c>
            </texttable>
        </section>

        <section anchor="icalendar-translation" title="Common properties">
            <t>
                This section contains recommendations how to map JSCalendar from and to iCalendar.
            </t>

            <texttable anchor="translate-commonprops-table" title="Translation between JSCalendar and iCalendar">

                <ttcol align='left'>Property</ttcol>
                <ttcol align='left'>iCalendar counterpart</ttcol>

                <c>@type</c>
                <c>
                    Determined by the iCalendar component type. <spanx style="verb">jsevent</spanx>
                    for VEVENT, <spanx style="verb">jstask</spanx> for VTODO,
                    <spanx style="verb">jsgroup</spanx> for VCALENDAR.
                </c>

                <c>alerts</c>
                <c>
                    An <spanx style="emph">Alert</spanx> maps to the VALARM component, where
                    the <spanx style="emph">action</spanx> maps to the iCalendar ACTION property value.
                    Both <spanx style="verb">DISPLAY</spanx> and <spanx style="verb">AUDIO</spanx> iCalendar
                    actions map to a JSCalendar <spanx style="verb">display</spanx> action. An EMAIL action maps
                    to a JSCalendar <spanx style="verb">email</spanx> action.
                    The OffsetTrigger <spanx style="emph">relativeTo</spanx> and <spanx style="emph">offset</spanx>
                    properties map to the iCalendar TRIGGER property.
                </c>

                <c>categories</c>
                <c>
                    The CONCEPT property, defined in <xref target="draft-ietf-calext-ical-relations"/>.
                </c>

                <c>color</c>
                <c>
                    The COLOR property, as specified in <xref target="RFC7986"/>.
                </c>

                <c>created</c>
                <c>
                    The CREATED property.
                </c>

                <c>description</c>
                <c>
                    The DESCRIPTION property.
                </c>

                <c>descriptionContentType</c>
                <c>
                    Implementation-specific.
                </c>

                <c>excluded</c>
                <c>
                    An EXDATE.
                </c>

                <c>freeBusyStatus</c>
                <c>
                    The TRANSP property.
                </c>

                <c>isAllDay</c>
                <c>
                    See <xref target="translate-time"/>.
                </c>

                <c>keywords</c>
                <c>
                    The CATEGORIES property, as specified in <xref target="RFC7986"/>.
                </c>

                <c>links</c>
                <c>
                    Maps the ATTACH (<xref target="RFC5545"/>), URL or IMAGE (<xref target="RFC7986"/>)
                    property values of URI value type as the Link <spanx style="emph">href</spanx>.
                    The Link <spanx style="emph">type</spanx> property
                    maps to the FMTTYPE parameter, the <spanx style="emph">size</spanx>
                    property to the SIZE parameter.
                    Mapping all other properties is implementation-specific.
                </c>

                <c>locale</c>
                <c>
                    The LANGUAGE parameter, which is added to individual properties.
                    When converting from iCalendar, one language must be picked as the main locale for the
                    object, and all properties in other languages moved to the localizations JSEvent property.
                </c>

                <c>localizations</c>
                <c>
                    Implementation-specific.
                </c>

                <c>locations</c>
                <c>
                    See <xref target="translate-locations"/>.
                </c>

                <c>method</c>
                <c>
                    The METHOD property of the embedding VCALENDAR.
                </c>

                <c>participants</c>
                <c>
                    See <xref target="translate-participants"/>.
                </c>

                <c>priority</c>
                <c>
                    The PRIORITY property.
                </c>

                <c>privacy</c>
                <c>
                    The CLASS property.
                </c>

                <c>prodId</c>
                <c>
                    The PRODID property.
                </c>

                <c>recurrenceOverrides</c>
                <c>
                    The RDATE and EXDATE properties, and any VEVENT or
                    VTODO instances with a recurrence-id and same UID
                    as the mapped main object.
                </c>

                <c>recurrenceRule</c>
                <c>
                    The RRULE property. For all-day calendar objects,
                    map the <spanx style="emph">until</spanx> property value to an iCalendar
                    DATE (effectively removing the time component). To convert a DATE-typed UNTIL
                    from iCalendar, set the time components of the LocalDate value to
                    <spanx style="verb">23:59:59</spanx>. If the iCalendar UNTIL value is a
                    UTC date time, convert it to the local time in the JSCalendar calendar
                    object time zone.
                </c>

                <c>relatedTo</c>
                <c>
                    The RELATED-TO property.
                </c>

                <c>replyTo</c>
                <c>
                    An iCalendar ORGANIZER with a mailto: URI mapped to the
                    <spanx style="verb">imip</spanx> method, or any other
                    URI mapped to the <spanx style="verb">other</spanx>
                    method. Mapping multiple methods is implementation-specific.
                </c>

                <c>sequence</c>
                <c>
                    The SEQUENCE property.
                </c>

                <c>start</c>
                <c>
                    See <xref target="translate-time"/>.
                </c>

                <c>status</c>
                <c>
                    The STATUS property (converted to lower-case).
                </c>

                <c>timeZone</c>
                <c>
                    See <xref target="translate-time"/>.
                </c>

                <c>timeZones</c>
                <c>
                    Each entry in the property maps to a VTIMEZONE in the embedding VCALENDAR component.
                </c>

                <c>title</c>
                <c>
                    The SUMMARY property.
                </c>

                <c>uid</c>
                <c>
                    The UID property.
                </c>

                <c>updated</c>
                <c>
                    The DTSTAMP and LAST-MODIFIED properties. (These are only
                    different in the iTIP case, and the difference is not actually useful.)
                </c>

                <c>useDefaultAlerts</c>
                <c>
                    Implementation-specific.
                </c>

                <c>virtualLocations</c>
                <c>
                    See <xref target="translate-locations"/>.
                </c>

            </texttable>

            <section anchor="translate-time" title="Time">
                <t>
                    JSEvent and JSTask share the <spanx style="emph">start</spanx>,
                    <spanx style="emph">timeZone</spanx> and <spanx style="emph">isAllDay</spanx>
                    properties to express their occurrence in time.
                    The following table defines how to map these shared properties:
                </t>
                <texttable anchor="translate-common-time-table" title="Mapping common time properties">
                    <ttcol align='left'>Property</ttcol>
                    <ttcol align='left'>iCalendar counterpart</ttcol>

                    <c>start with non-null timeZone</c>
                    <c>
                        The <spanx style="emph">start</spanx> property value maps to
                        an iCalendar DTSTART of type local DATE-TIME and the
                        <spanx style="emph">timeZone</spanx> value to the TZID
                        parameter. If the time zone is <spanx style="verb">Etc/UTC</spanx>,
                        then the start time may alternatively map to an iCalendar
                        UTC DATE-TIME without a TZID parameter.
                    </c>

                    <c>start and isAllDay is true</c>
                    <c>
                        The <spanx style="emph">start</spanx> property value maps to
                        an iCalendar DTSTART property value of type DATE. When mapping
                        from iCalendar, the time component of the
                        <spanx style="emph">start</spanx> property value is zero.
                    </c>

                    <c>start with null timeZone and isAllDay is false</c>
                    <c>
                        The <spanx style="emph">start</spanx> property value maps
                        to an iCalendar DTSTART of type local DATE-TIME and no TZID
                        parameter.
                    </c>
                </texttable>
            </section>


            <section anchor="translate-locations" title="Locations">
                <t>
                    The iCalendar counterpart for JSCalendar Location objects is the iCalendar
                    <xref target="RFC5545"/> LOCATION property, or implementation-specific.
                  </t>
                <texttable anchor="translate-locations-table"
                  title="Translation of Location between JSCalendar and iCalendar">
                  <ttcol align='left'>Property</ttcol>
                  <ttcol align='left'>iCalendar counterpart</ttcol>

                  <c>coordinates</c>
                  <c>
                      Implementation-specific. Consider using a GEO iCalendar property, along with one LOCATION.
                  </c>

                  <c>description</c>
                  <c>
                      Implementation-specific.
                  </c>

                  <c>linkIds</c>
                  <c>
                      Implementation-specific.
                  </c>

                  <c>name</c>
                  <c>
                      The LOCATION property value.
                  </c>

                  <c>rel</c>
                  <c>
                      Implementation-specific.
                  </c>

                  <c>timeZone</c>
                  <c>
                      Implementation-specific.
                  </c>

                  <c>uri</c>
                  <c>
                      The LOCATION ALTREP parameter.
                  </c>

                </texttable>
                <t>
                    The iCalendar counterpart for JSCalendar VirtualLocation objects is the iCalendar
                    <xref target="RFC7986"/> CONFERENCE property, or implementation-specific.
                </t>
                <texttable anchor="translate-virtualLocations-table"
                  title="Translation of VirtualLocation between JSCalendar and iCalendar">
                    <ttcol align='left'>Property</ttcol>
                    <ttcol align='left'>iCalendar counterpart</ttcol>
                    <c>description</c>
                    <c>
                        Implementation-specific.
                    </c>

                    <c>name</c>
                    <c>
                        The CONFERENCE LABEL parameter.
                    </c>

                    <c>uri</c>
                    <c>
                        The CONFERENCE property value.
                    </c>
                </texttable>
            </section>

            <section anchor="translate-participants" title="Participants">
                <t>
                    The following table outlines translation of JSCalendar participants. Where
                    iCalendar has distinct properties for ORGANIZER and ATTENDEE, these are merged
                    in JSCalendar into the Participant object type.
                </t>
                <texttable anchor="translate-participants-table"
                    title="Translation of Participant between JSCalendar and iCalendar">
                    <ttcol align='left'>Property</ttcol>
                    <ttcol align='left'>iCalendar counterpart</ttcol>

                    <c>attendance</c>
                    <c>
                        The ROLE parameter values REQ-PARTICIPANT, OPT-PARTICIPANT and
                        NON-PARTICIPANT.
                    </c>

                    <c>delegatedFrom</c>
                    <c>
                        The DELEGATED-FROM parameter
                    </c>

                    <c>delegatedTo</c>
                    <c>
                        The DELEGATED-TO parameter
                    </c>

                    <c>email</c>
                    <c>
                        The value of the EMAIL parameter of the ORGANIZER or ATTENDEE property, if
                        defined. Otherwise the property value, if it is a mailto: URI.
                    </c>

                    <c>expectReply</c>
                    <c>
                        The RSVP parameter
                    </c>

                    <c>kind</c>
                    <c>
                        The CUTYPE parameter
                    </c>

                    <c>linkIds</c>
                    <c>
                        Implementation-specific.
                    </c>

                    <c>locationId</c>
                    <c>
                        Implementation-specific. When mapping from iCalendar to JSCalendar this
                        may be the JSCalendar identifier of a CONFERENCE property that has the
                        MODERATOR feature defined in its FEATURE parameter values. If multiple
                        such CONFERENCE properties are defined in iCalendar, then the one with the
                        most interactive features is chosen.
                    </c>

                    <c>memberOf</c>
                    <c>
                        The MEMBER parameter
                    </c>

                    <c>name</c>
                    <c>
                        The CN parameter
                    </c>

                    <c>participationStatus</c>
                    <c>
                        The PARTSTAT parameter
                    </c>

                    <c>roles</c>
                    <c>
                        The <spanx style="verb">chair</spanx> role maps to the standard iCalendar ROLE
                        parameter value <spanx style="verb">chair</spanx>, with an implicit participant
                        of value <spanx style="verb">required</spanx>. The mapping of non-required chairs
                        and other roles is implementation-specific, but using <spanx style="verb">x-name</spanx>
                        parameter values is recommended.
                    </c>

                    <c>scheduleSequence</c>
                    <c>
                        The SEQUENCE property of the participant's latest iMIP message
                    </c>

                    <c>scheduleUpdated</c>
                    <c>
                        The DTSTAMP property of the participant's latest iMIP message
                    </c>

                    <c>sendTo</c>
                    <c>
                        An iCalendar ATTENDEE with a mailto: URI mapped to the
                        <spanx style="verb">imip</spanx> method, or any other
                        URI mapped to the <spanx style="verb">other</spanx>
                        method. Mapping multiple methods is implementation-specific.
                    </c>

                </texttable>
            </section>

        </section>

        <section anchor="translate-custom" title="Custom properties">
            <t>
                Mapping custom or unknown properties between JSCalendar and iCalendar
                is implementation-specific. Implementors that miss a property in
                JSCalendar may want to use a vendor-extension property, which could
                also serve as basis for discussion for a JSCalendar standard extension.
                Alternatively, an implementation could preserve iCalendar properties
                and components in JSCalendar by use of a vendor-extension
                property formatted as jCal <xref target="RFC7265"/> data.
            </t>
        </section>

        <section anchor="security-considerations" title="Security Considerations">
            <t>
                The same security considerations as for <xref target="draft-ietf-calext-jscalendar"/> apply.
            </t>
        </section>

        <section anchor="iana-considerations" title="IANA Considerations">
            <t>
                None.
            </t>
        </section>

        <section anchor="acknowledgments" title="Acknowledgments">
            <t>
                The authors would like to thank the members of CalConnect for their valuable contributions. This
                specification originated from the work of the API technical committee of CalConnect, the Calendaring and
                Scheduling Consortium.
            </t>
        </section>
    </middle>

    <back>
        <references title="Normative References">
            <?rfc include="http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5545.xml"?>
            <?rfc include="http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7265.xml"?>
            <?rfc include="http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7986.xml"?>
        </references>
        <references title="Informative References">
            <reference anchor="draft-ietf-calext-jscalendar"
                target="https://tools.ietf.org/html/draft-ietf-calext-jscalendar">
                <front>
                    <title>Task Extensions to iCalendar</title>
                    <author/>
                    <date/>
                </front>
            </reference>
            <reference anchor="draft-apthorp-ical-tasks"
                       target="https://tools.ietf.org/html/draft-apthorp-ical-tasks">
                <front>
                    <title>Task Extensions to iCalendar</title>
                    <author/>
                    <date/>
                </front>
            </reference>
            <reference anchor="draft-ietf-calext-ical-relations"
                       target="https://tools.ietf.org/html/draft-ietf-calext-ical-relations">
                <front>
                    <title>Support for iCalendar Relationships</title>
                    <author/>
                    <date/>
                </front>
              </reference>
        </references>
    </back>
</rfc>
